function parseSendObjs(e){}function getBindCFComponent(e){return $('[bind-componentid="'+e+'"]')}function applyBindableResponseToNodeChildren(e,t){var n=0;if("true"==e.SELF)var o=$(t).children(e.SELECTOR);else{var a=$(t).children(":not([bind-componentid])");for(childNode of a)n=+applyBindableResponseToNodeChildren(e,childNode);var o=$(t).children(e.SELECTOR)}var r="";for(r of o){var d=$(r);if(d.is(e.SELECTOR)||"true"==e.SELF)switch(e.ACTION.toLowerCase()){case"loadroute":$bind.loadRoute(e.VALUE,e.NAME);break;case"back":window.history.back();break;case"forward":window.history.forward();break;case"call":window[e.NAME]($bind.getVarOrJSON(e.DATA)),rebindNodeEvents(d);break;case"replace":d.html(e.VALUE),rebindNodeEvents(d);break;case"append":d.append(e.VALUE),rebindNodeEvents($(d));break;case"prepend":d.prepend(e.VALUE),rebindNodeEvents($(d));break;case"remove":d.remove();break;case"hide":d.hide();break;case"show":o.show();break;case"toggle":d.toggle();break;case"fadeout":d.fadeOut(e.VALUE);break;case"fadein":d.fadeIn(e.VALUE);break;case"setvalue":d.val(e.VALUE);break;case"addclass":d.addClass(e.VALUE);break;case"removeclass":d.removeClass(e.VALUE);break;case"replaceclass":d.removeClass(e.OLDVALUE),d.addClass(e.VALUE);break;case"setattr":d.prop(e.ATTRNAME,e.VALUE);break;case"removeattr":d.removeAttr(e.ATTRNAME);break;case"addbindevent":var i=d.attr("bind-events");d.attr("bind-events",i+" "+e.VALUE);break;case"removebindevent":var i=d.attr("bind-events");d.attr("bind-events",i.replace(RegExp("(?:^|\\s)"+e.VALUE+"(?:\\s|$)")," "));break;case"replacebindevent":var i=d.attr("bind-events");d.attr("bind-events",i.replace(RegExp("(?:^|\\s)"+e.OLDVALUE+"(?:\\s|$)")," ")),i=d.attr("bind-events"),d.attr("bind-events",i+" "+e.VALUE);break;case"faderemove":d.fadeOut(parseInt(e.TIME),function(){$(this).remove()});break;case"fadeappend":d.append($(e.VALUE).hide().fadeIn(e.TIME)),rebindNodeEvents(d);break;case"fadeprepend":d.prepend($(e.VALUE).hide().fadeIn(e.TIME)),rebindNodeEvents(d);break;case"fadereplace":d.html($(e.VALUE).hide().fadeIn(e.TIME)),rebindNodeEvents(d);break;case"add":d.add($(e.VALUE.trim())),rebindNodeEvents(d)}}return n}function bindCFLog(e,t){}function handleBindableResponse(e){for(task of(console.log(e),$bind.setModelByComponentId(e.BIND_RESPONSE.MODEL.componentid,e.BIND_RESPONSE.MODEL),e.updatedChildren=0,e.BIND_RESPONSE.TASKS))"dipatch"!=task.ACTION.toLowerCase()&&"publish"!=task.ACTION.toLowerCase()&&(e.updatedChildren+=applyBindableResponseToNodeChildren(task,getBindCFComponent(task.COMPONENTID)));for(task of(udpatedChildren=0,e.BIND_RESPONSE.TASKS))if("dispatch"==task.ACTION.toLowerCase()||"publish"==task.ACTION.toLowerCase()||"broadcast"==task.ACTION.toLowerCase()){var t=$('[bind-componentid="'+task.COMPONENTID+'"]');if("dispatch"==task.ACTION.toLowerCase())var n=t.closest('[bind-events~="'+task.TYPE+'"]');if("publish"==task.ACTION.toLowerCase())var n=t.find('[bind-events~="'+task.TYPE+'"]');if("broadcast"==task.ACTION.toLowerCase())var n=$('[bind-events~="'+task.TYPE+'"]');if(n&&0!=n.length)for(listener of n){listener=$(listener);var o={type:task.ACTION.toLowerCase(),data:{id:listener.attr("id"),action:task.ACTION.toLowerCase(),type:task.TYPE,value:task.VALUE,formdata:$bind.getComponentForm(listener),key:listener.attr("key"),attrs:getAttributesCollection(listener),tagname:listener[0].tagName.toLowerCase(),componentid:$bind.getComponentId(listener),formdata:$bind.getComponentForm(listener),data:task.DATA,bodyComponentId:$bind.getBodyComponentId(),model:$bind.getModelByNode(listener),dispatcherdata:{type:task.TYPE,data:{id:listener.attr("id"),action:task.ACTION.toLowerCase(),value:task.VALUE,formdata:$bind.getComponentForm(t),key:t.attr("key"),attrs:getAttributesCollection(t),tagname:t[0].tagName.toLowerCase(),componentid:$bind.getComponentId(t),formdata:$bind.getComponentForm(t),data:task.DATA,bodyComponentId:$bind.getBodyComponentId(),model:$bind.getModelByNode(t)}}}};console.log("payload"),console.log(o);var a=$(listener).children().first().parents("[bind-handler]").first().attr("bind-handler");$.ajax({url:a,crossDomain:!0,type:"POST",data:"BINDFRAMEWORK_DATA="+JSON.stringify(o),success:function(e){"object"==typeof e?handleBindableResponse(e):handleBindableResponse(JSON.parse(e))}})}else console.log("could not find a listener/subscriber component for "+task.ACTION.toLowerCase()+":"+task.TYPE+".  check that you have a bind-component with this type.  NOTE: possible values for the attributes bind-listens should be SPACE DELIMITED")}}function getAttributesCollection(e){var t=[];return $(e).each(function(){$.each(this.attributes,function(){this.specified&&t.push({name:this.name,value:this.value})})}),t}function handleBindableCFEvent(e){var t="";"enter"!=e.type&&(t=e.currentTarget.tagName.toLowerCase());var n=e.type,o=e.currentTarget;"enter"===e.type&&(e=event,n="enter",o=this),console.log("bindable event triggered:"),console.log(e),payload={type:"handleEvent",data:{id:$(o).attr("id"),type:n,formdata:$bind.getComponentForm(o),key:$(o).attr("key"),attrs:getAttributesCollection($(o)),tagname:t,componentid:$(o).parents("[bind-componentid]").first().attr("bind-componentid"),bodyComponentId:$bind.getBodyComponentId(),model:$bind.getModelByNode(o)}},console.log("payload"),console.log(payload);var a=$(e.currentTarget).parents("[bind-handler]").first().attr("bind-handler");$.ajax({url:a,crossDomain:!0,type:"POST",data:"BINDFRAMEWORK_DATA="+JSON.stringify(payload),success:function(e){"object"==typeof e?handleBindableResponse(e):handleBindableResponse(JSON.parse(e))}})}var $bind={models:[],routeRoot:"/",init:function(){$("body").attr("bind-component")||$("body").attr("bind-component","true"),$("body").attr("bind-componentid")||$("body").attr("bind-componentid",createBindCFUUIDName()),rebindNodeEvents($("body")),dispatchComponentReady($("body")),$bind.hideAllRoutes(),$bind.loadRoute($bind.routeRoot),window.addEventListener("popstate",function(e){console.log("Location: "+document.location),console.log("State: "+JSON.stringify(e.state));var t=e.state&&e.state.route?e.state.route:$bind.routeRoot;$bind.loadRoute(t)})},attachRouteLinkHandlers:function(){document.querySelectorAll("[bind-route-link]").forEach(function(e){e.removeEventListener("click",$bind.handleBindRouteLinkClick),e.addEventListener("click",$bind.handleBindRouteLinkClick)})},handleBindRouteLinkClick:function(e){e.preventDefault();var t=e.target.getAttribute("bind-route-link");t=$bind.getRootedRoute(t,e.target);var n=e.target.getAttribute("bind-route-name");n&&""!==n.trim()||(n=window.document.title),$bind.navigate(t,n)},navigate:function(e,t){window.history.pushState({route:e,name:t},t,$bind.routeRoot+e),$bind.loadRoute(e)},hideAllRoutes:function(){document.querySelectorAll("[bind-routes]").forEach(function(e){$(e).hide()})},loadRoute:function(e,t=!0){var n=[],o=[],a=document.querySelectorAll("[bind-routes]"),r={};return a.forEach(function(e){var t=e.getAttribute("bind-routes"),n=e.getAttribute("bind-show-routes");if(r={element:e,routeString:t,routes:[],showString:n,show:[]},null!==t){var a=t.split(" ");a.forEach(function(t){r.routes.push($bind.getRootedRoute(t,e))})}if(null!==n){var a=n.split(" ");a.forEach(function(t){r.show.push($bind.getRootedRoute(t,e))})}o.push(r)}),o.forEach(function(t){t.routes.includes(e)&&(console.log("showing route: "+e),n.push(t),t.show.forEach(function(e){n.push(...$bind.loadRoute(e,!1))}))}),console.log("routesToShow:"),console.log(n),t&&(a.forEach(function(e){n.some(t=>t.element===e)||$(e).hide()}),n.forEach(function(e){$(e.element).is(":visible")||($(e.element).show(),$(e.element).trigger("showroute.bindEvent",e))})),n},getRootedRoute:function(e,t){if(!e.includes("{myroot}"))return e;var n=t.parentNode.closest("[bind-route-root]");if(n)return e=e.replace("{myroot}",n.getAttribute("bind-route-root")),$bind.getRootedRoute(e,n);e=e.replace("{myroot}",$bind.routeRoot)},getComponentById:e=>$('[bind-componentid="'+e+'"]'),getMyParentComponent(e){return $(this.getMyComponent(e)).parents("[bind-componentid]").first()},getMyComponent:e=>$(e).attr("bind-componentid")?$(e):$(e).parents("[bind-componentid]").first(),getVarOrJSON:function(e){try{return JSON.parse(e)}catch(t){return e}},getComponentId:function(e){return this.getMyComponent(e).attr("bind-componentid")},getModelByNode:function(e){return this.getModelByComponentId(this.getComponentId(e))},getModelByComponentId:function(e){return this.models[e]||(this.models[e]={componentid:e,data:{}}),this.models[e]},setModelByComponentId:function(e,t){return this.models[e]||(this.models[e]={componentid:e,data:{}}),this.models[e]=t,this.models[e]},getBodyComponentId:function(){return this.bodyComponentId||(this.bodyComponentId=$("body").attr("bind-componentid")),this.bodyComponentId},setFormDataObjElement:function(e,t,n,o){for(var a=0;a<e.forms.length;a++)if(e.forms[a].name==t)return e.forms[a].fields[n]&&e.forms[a].fields[n].length>0?e.forms[a].fields[n]=e.forms[a].fields[n].split(",").concat([o]).join(","):e.forms[a].fields[n]=o,e;return e.forms[e.forms.length]={name:t,fields:{}},e.forms[e.forms.length-1].fields[n]=o,e},getComponentForm:function(e){var t=this.getMyComponent(e);return this.getFormDataForChildren(t,{forms:[{name:"_noFormName",fields:{}}]})},getFormDataForChildren:function(e,t){var n="",o=$(e).children("input");for(a of o){var a=$(a);n=0==a.closest("form[name]").length?"_noFormName":a.closest("form[name]").attr("name"),("checkbox"!=a.attr("type")&&"radio"!=a.attr("type")||"checkbox"==a.attr("type")&&a[0].checked)&&(t=this.setFormDataObjElement(t,n,a.attr("name"),a.val())),"radio"==a.attr("type")&&a[0].checked&&(t=this.setFormDataObjElement(t,n,a.attr("name"),a.val()))}for(a of o=$(e).children("select")){var a=$(a),r="";n=0==a.closest("form[name]").length?"_noFormName":a.closest("form[name]").attr("name"),r=a.attr("multiple")?a.val().join(","):a.val(),t=this.setFormDataObjElement(t,n,a.attr("name"),r)}for(a of o=$(e).children("textarea")){var a=$(a);n=0==a.closest("form[name]").length?"_noFormName":a.closest("form[name]").attr("name"),t=this.setFormDataObjElement(t,n,a.attr("name"),a.val())}var d=$(e).children(":not([bind-component])");for(child of d)t=this.getFormDataForChildren(child,t);return t}};function processComponentLoadingForNode(e){var t=$("[bind-load]");for(nodeToLoad of t)"1"!=(nodeToLoad=$(nodeToLoad)).attr("bind-loaded")&&"1"!=nodeToLoad.attr("bind-loading")&&(nodeToLoad.attr("bind-loading",1),console.log(nodeToLoad.attr("bind-componentid")+" loading: "+nodeToLoad.attr("bind-load")),$.ajax({url:nodeToLoad.attr("bind-load"),crossDomain:!0,type:"GET",data:"BINDFRAMEWORK_DATA=",componentid:nodeToLoad.attr("bind-componentid"),success:function(e){var t=$('[bind-componentid="'+this.componentid+'"]');t.html(e),t.attr("bind-loading","0"),t.attr("bind-loaded","1"),console.log(this.componentid+" loaded: "+this.url),rebindNodeEvents(t),dispatchComponentReady(t)}}));let n=Array.from(document.querySelectorAll("[bind-route-root]")).reduce((e,t)=>{let n=t.getAttribute("bind-route-root").split("/").length,o=e?e.getAttribute("bind-route-root").split("/").length:0;return n>o?t:e},null)?.getAttribute("bind-route-root")||"BIND_NO_ROUTE_ROOT_DEFINED";$bind.routeRoot=n;var o=$("[bind-route]");for(nodeToRoute of o)nodeToRoute=$(nodeToRoute)}function dispatchComponentReady(e){var t=$("body").attr("bind-handler"),n=$(e).attr("bind-componentid");"body"==e[0].tagName.toLowerCase()?t&&0!=t.trim().length||(t="#",$("body").attr("bind-handler",t)):(t=e.attr("bind-handler"))||(t=$(e).parents("[bind-handler]").first().attr("bind-handler"));var o={type:"ready",data:{id:$(e).attr("id"),key:$(e).attr("key"),type:"ready",attrs:getAttributesCollection($(e)),tagname:$(e)[0].tagName.toLowerCase(),componentid:n,bodyComponentId:$bind.getBodyComponentId(),model:$bind.getModelByNode(e)}};console.log("payload"),console.log(o),$.ajax({url:t,crossDomain:!0,type:"POST",data:"BINDFRAMEWORK_DATA="+JSON.stringify(o),success:function(e){"object"==typeof e?handleBindableResponse(e):handleBindableResponse(JSON.parse(e))}})}function rebindNodeEvents(e){$(e).find("[bind-load]").map((e,t)=>{$(t).attr("bind-component",!0)}),$(e).find("[bind-handler]").map((e,t)=>{$(t).attr("bind-component",!0)}),$(e).find('[bind-component="true"]').map((e,t)=>{let n=$(t).attr("bind-componentid");n&&0!=n.length||$(t).attr("bind-componentid",createBindCFUUIDName())}),$(e).find('[bind-componentid=""]').map((e,t)=>{$(t).attr("bind-componentid",createBindCFUUIDName())}),processComponentLoadingForNode(e),$(e).find("[bind-events]").map((e,t)=>{(eventTypes=$(t).attr("bind-events")).split(" ").map(e=>{"enter"===(e=e.trim())?$(t).unbind("keydown.bindEvent").bind("keydown.bindEvent",function(e){13==e.keyCode&&(e.preventDefault(),handleBindableCFEvent.call(this,new CustomEvent("enter",e)))}):$(t).unbind(e+".bindEvent").bind(e+".bindEvent",handleBindableCFEvent)})}),$bind.attachRouteLinkHandlers()}function uuidv4NoDashes(){return"10000000100040008000100000000000".replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}function createBindCFUUIDName(){return"bind_"+uuidv4NoDashes()}$("document").ready(function(){$bind.init()});